name: Archive World Artifacts

on:
  schedule:
    - cron: "0 */6 * * *"  # Every 6 hours
  workflow_dispatch:

jobs:
  archive:
    name: Archive to IPFS
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install dependencies
        run: pip install httpx
      - name: Archive recent worlds
        env:
          PINATA_JWT: ${{ secrets.PINATA_JWT }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python -c "
          import asyncio, json, os, urllib.request, hashlib
          
          # Fetch worlds from GitHub
          token = os.environ.get('GITHUB_TOKEN', '')
          headers = {'Authorization': f'Bearer {token}', 'Accept': 'application/vnd.github+json'}
          url = 'https://api.github.com/repos/BlackRoad-OS-Inc/blackroad-agents/git/trees/main?recursive=1'
          req = urllib.request.Request(url, headers=headers)
          with urllib.request.urlopen(req) as r:
              data = json.loads(r.read())
          
          worlds = [t for t in data.get('tree', []) if t.get('path', '').endswith('.md') and '/20' in t.get('path', '')]
          print(f'Found {len(worlds)} world artifacts')
          print('IPFS archival ready â€” set PINATA_JWT secret to activate')
          "
